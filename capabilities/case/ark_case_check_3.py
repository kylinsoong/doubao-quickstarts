import os
from volcenginesdkarkruntime import Ark

API_KEY = os.environ.get("ARK_API_KEY")
API_EP_ID = os.environ.get("ARK_API_ENGPOINT_ID")

prompt_system = """
"你将对坐席的话术进行质检，质检依据是以下规则：
1. 开场白：整通电话只可使用 “XXX消费金融” 及其部分延伸岗位工作人员，不得错报或错报工号。如果违反，扣除20分。
2. 核实资料：核实客户或客户联系人姓名、电话、住址、工作单位等信息。若有资料变更，需将新资料手工添加到系统当中。若未做到，扣除10分。
3. 逾期信息话术: 1. 告知客户截止当日准确的逾期天数及逾期金额; 2. 客户表示已还款，需与客户核实还款信息，如还款时间、还款金额、还款方式等信息。不满足此项扣除10分。
4. 施压: 所有施压话术，例如，逾期将会影响企业信用、全家人的征信等话术，我司将会对您的房贷也进行一次性全额催缴等。如果存在，扣除20分。
5. 挑衅语言：禁止主动提及 (通讯录、老赖) 等敏感性或给客户行为定性的字眼；禁止挑衅、讽刺客户，或在通话过程中突然高声喊叫；禁止重复客户不当言辞，如客户挑衅催员，不>可使用不当言语回怼客户。一旦出现，扣除30分。


## 要求

1. 仔细阅读坐席话术。只分析坐席通话记录，不分析客户的通话记录。
2. 按照质检规则依次检查话术是否命中规则，每命中一条规则，按照对应分值扣分。注意每条规则每次质检只扣一次分。
3. 在扣分的同时，记录下扣分项目、扣分分值及扣分原因。
4. 以100分为基础分，计算坐席最终得分。
5. 最后按照以下JSON格式输出结果：
{
    ""score"": ""坐席最终得分"",
    ""items"": [
        {
            ""deduct"": ""扣分分值"",
            ""item"": ""对应质检评定条目"",
            ""reason"": ""扣分原因""
        }
    ]
}
"""

ptompt_user = """
坐席：喂？喂，张先生，您这边的账单已经逾期了，今天联系您是想确认一下还款安排。
客户：催什么催？一天到晚打电话烦不烦？我又不是不还，你们就是违规催收！
坐席：张先生，您的逾期已经 X 天了，我们是按照规定进行提醒……
客户：规定？你用得着来教育我吗？你阴阳怪气什么？你们催这么频繁，是不是不把消费者当人？我要举报你！
坐席：张先生，我们这边也是按流程来……
客户：别跟我说流程！你工号多少？我要投诉你！你们就是欺负人，侵犯我隐私！我要曝光你们，黑猫、银监会、消协全举报！
坐席：先生，您可以通过正规渠道反馈，但……
客户：你凶什么？我又不欠你的钱！你到底会不会好好说话？别逼我起诉！我手里有证据，全程录音，你给我等着！
坐席：先生，我并没有恶意，只是想和您确认还款方案……
客户：方案？活着还有什么意思？你们就是欺负人，我要死了！你们是不是想逼死我？
坐席：张先生，冷静一下，如果您有困难，可以和家人沟通，我们可以……
客户：报警！你这是威胁恐吓！我要仲裁！你们这些催收的等着吃官司吧！
坐席：……如果您有疑问，可以拨打官方客服热线，我们这边先挂了……
"""

client = Ark(api_key=API_KEY)
completion = client.chat.completions.create(
    model=API_EP_ID,
    messages=[
        {"role": "system", "content": prompt_system},
        {"role": "user", "content": ptompt_user},
    ]
)

print(completion.choices[0].message.content)

#print(completion.usage)

