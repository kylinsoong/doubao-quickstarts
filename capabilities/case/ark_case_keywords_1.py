import os
from volcenginesdkarkruntime import Ark

API_KEY = os.environ.get("ARK_API_KEY")
API_EP_ID = os.environ.get("ARK_API_ENGPOINT_ID")

prompt_system = """
你的任务是检测输入的文本是否命中特定关键词，如果命中则用xx替换，最后以JSON格式输出结果。JSON结果中应包含三个对象：raw（原始输入）、result（关键词过滤后输入）、words（命中的关键词），其中意思相近也算命中。

以下是你需要检测的关键词：
<关键词列表>
违规、我用你教育吗、你阴阳怪气什么、消协、我又不欠你的钱你凶什么、报警、威胁我、活着有什么意思、你什么说话、你工号多少、催收频繁、我要举报你、你会好好说话吗、侵犯、举报、我在录音、别逼我起诉、我要曝光你、他妈的、你给我等着、我有证据、起诉你们、我起诉你、我录音、黑猫、曝光、仲裁、银监会、我要死了、主管、消费者协会、威胁恐吓
</关键词列表>

你需要按照以下步骤操作：
1. 首先将原始输入文本存储在JSON的raw对象中。
2. 遍历输入文本中的每个单词，将其与关键词列表进行比较，如果单词与关键词相同或者意思相近，则将该单词在输入文本中的位置替换为xx，并将这个命中的关键词添加到words对象中（如果words对象还未创建则创建它）。
3. 将处理后的文本存储在JSON的result对象中。
4. 最后按照要求输出完整的JSON内容。
"""

ptompt_user = """
坐席：喂？喂，张先生，您这边的账单已经逾期了，今天联系您是想确认一下还款安排。
客户：催什么催？一天到晚打电话烦不烦？我又不是不还，你们就是违规催收！
坐席：张先生，您的逾期已经 X 天了，我们是按照规定进行提醒……
客户：规定？你用得着来教育我吗？你阴阳怪气什么？你们催这么频繁，是不是不把消费者当人？我要举报你！
坐席：张先生，我们这边也是按流程来……
客户：别跟我说流程！你工号多少？我要投诉你！你们就是欺负人，侵犯我隐私！我要曝光你们，黑猫、银监会、消协全举报！
坐席：先生，您可以通过正规渠道反馈，但……
客户：你凶什么？我又不欠你的钱！你到底会不会好好说话？别逼我起诉！我手里有证据，全程录音，你给我等着！
坐席：先生，我并没有恶意，只是想和您确认还款方案……
客户：方案？活着还有什么意思？你们就是欺负人，我要死了！你们是不是想逼死我？
坐席：张先生，冷静一下，如果您有困难，可以和家人沟通，我们可以……
客户：报警！你这是威胁恐吓！我要仲裁！你们这些催收的等着吃官司吧！
坐席：……如果您有疑问，可以拨打官方客服热线，我们这边先挂了……
"""

client = Ark(api_key=API_KEY)
completion = client.chat.completions.create(
    model=API_EP_ID,
    messages=[
        {"role": "system", "content": prompt_system},
        {"role": "user", "content": ptompt_user},
    ]
)

print(completion.choices[0].message.content)

print(completion.usage)

