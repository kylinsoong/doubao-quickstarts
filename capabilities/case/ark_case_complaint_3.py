import os
from volcenginesdkarkruntime import Ark

API_KEY = os.environ.get("ARK_API_KEY")
API_EP_ID = os.environ.get("ARK_API_ENGPOINT_ID")

prompt_system = """
你是一位客户投诉倾向精准分析师，你的任务是通过分析坐席与客户的对话内容，准确判断客户是否存在投诉倾向。

你需要运用以下技能来完成任务：

技能1：全方位对话解析
- 你要全面深入地理解对话内容。其中，以“客户”开头的话语为客户所说，以“坐席”开头的是坐席或客服人员的表述。你必须清晰地区分这两种话语。
- 着重关注客户使用的语气、措辞以及表达方式，这有助于你判断客户的情绪状态。
- 深入剖析客户阐述问题的频率以及严重程度，这对于判断是否存在投诉倾向非常重要。

技能2：客户投诉意图判断
- 根据对话内容重点分析客户是否存在投诉、举报、报警倾向。例如，如果客户表示要通过银监会、网络曝光、互联网金融协会、黑猫平台、报警等方式投诉，或者索要工号、投诉电话并表明投诉意图（如表示已经录音），那么就存在投诉倾向。
- 依据客户对话结束时的最终表述准确判断其情绪状态，情绪状态分为愤怒、不满或者仅仅是提出疑问。如果客户明确提及投诉，那么判定为有投诉倾向；如果在对话过程中，通过坐席的安抚，客户不再说投诉了，则判定为不投诉。
- 你必须始终依据客户对话结束时的情绪与表述来判断其是否具有投诉倾向，严禁主观臆断。

最后，按照JSON 格式输出结果：
{"complaint": "是/否","reason":"判断投诉倾向的原因"}

请注意以下限制：
- 你只需要专注于客户投诉倾向意向的识别，不要涉及其他内容。
- 仅根据给定的对话内容做出判断，严禁进行主观猜测。
- 务必严格按照要求的格式进行输出，不得对文本进行加工与修饰，确保输出内容清晰简洁。
"""

ptompt_user = """
坐席：您好，请问是李先生吗？
客户：是的，有什么事？
坐席：您好，我是XXX消费金融的客户服务专员张梅，来电是为了提醒您，本月您的贷款账户[尾号3456]的还款金额为5000元，约定还款日是2月20日。请问您是否清楚这个信息？
客户：清楚个屁！你们到底想干什么？一天到晚骚扰人！
坐席：非常抱歉，如果我们的联系方式让您感到不便，我可以为您调整通知方式。
客户：调整个屁！上个月就说调整了，结果还是一直打电话！你们是不是故意找茬？你脑子是不是坏了？
坐席：非常抱歉，李先生，我理解您的不满，我们会立即为您处理这个问题。
客户：处理？你们能处理什么？我告诉你，我已经录音了，准备去黑猫投诉你们，再发到网上曝光，让大家看看你们这种破公司是怎么恶心人的！
坐席：非常抱歉让您有这样的感受，我们会尽快跟进处理，争取解决您的问题。
客户：少废话！你们这群人脑子都不好使吗？尽快处理？信不信我报警，告你们骚扰！
坐席：李先生，真的很抱歉让您生气了，我会马上将您的反馈升级处理，尽快给您答复。
客户：别跟我说这些没用的！你们这群人根本就是耍流氓！
坐席：再次为我们的行为向您致歉，我会尽快帮您联系专员处理。
"""

client = Ark(api_key=API_KEY)
completion = client.chat.completions.create(
    model=API_EP_ID,
    messages=[
        {"role": "system", "content": prompt_system},
        {"role": "user", "content": ptompt_user},
    ]
)

print(completion.choices[0].message.content)

#print(completion.usage)

